CREATE TABLE USERS (
    USER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ユーザーID
    NAME VARCHAR2(64) NOT NULL UNIQUE, -- ユーザー名（ユニーク制約付き）
    CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
    UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
    HASHED_PASSWORD VARCHAR2(128) NOT NULL, -- ハッシュ化されたパスワード
    PRIMARY KEY (USER_ID) -- ユーザーIDを主キーに設定
);

CREATE TABLE NODE_TYPE (
    NODE_TYPE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ノードの種類ID
    NODE_NAME VARCHAR2(64) NOT NULL, -- ノード名
    PRIMARY KEY (NODE_TYPE_ID) -- ノード種類IDを主キーに設定
);

CREATE TABLE STAGE (
    STAGE_ID VARCHAR2(5) NOT NULL, -- 0から始まる5桁のステージID（手動入力）
    CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
    UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
    FLOOR_NUMBER NUMBER NOT NULL, -- フロア番号
    BUILDING_NUMBER NUMBER NOT NULL, -- 号館番号
    DESCRIPTION VARCHAR2(256) NOT NULL, -- ステージの説明
    STAGE_NAME VARCHAR2(64) NOT NULL, -- ステージ名
    PRIMARY KEY (STAGE_ID) -- ステージIDを主キーに設定
);

CREATE TABLE ALGORITHM (
    ALGORITHM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- アルゴリズムID
    CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
    UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
    USER_ID NUMBER NOT NULL, -- ユーザーID
    STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID
    PRIMARY KEY (ALGORITHM_ID), -- アルゴリズムIDを主キーに設定
    FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID), -- ユーザーIDを参照
    FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID) -- ステージIDを参照
);

CREATE TABLE NODE (
    NODE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ノードID
    SEQUENCE_NUMBER NUMBER NOT NULL, -- ノードの順番
    NODE_TYPE_ID NUMBER NOT NULL, -- ノードの種類ID
    ALGORITHM_ID NUMBER NOT NULL, -- アルゴリズムID
    LOOP_COUNT NUMBER DEFAULT 0 NOT NULL, -- 繰り返し回数（0: 繰り返しなし）
    PRIMARY KEY (NODE_ID), -- ノードIDを主キーに設定
    FOREIGN KEY (NODE_TYPE_ID) REFERENCES NODE_TYPE (NODE_TYPE_ID), -- ノード種類を参照
    FOREIGN KEY (ALGORITHM_ID) REFERENCES ALGORITHM (ALGORITHM_ID) -- アルゴリズムIDを参照
);

CREATE TABLE STAGE_CLEAR_HISTORY (
    CLEAR_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- クリア履歴ID
    CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
    USER_ID NUMBER NOT NULL, -- ユーザーID
    STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID
    ALGORITHM_ID NUMBER NOT NULL, -- 使用したアルゴリズムID
    CLEAR_TIME NUMBER NOT NULL, -- ステージクリアタイム（秒）
    PRIMARY KEY (CLEAR_ID), -- クリア履歴IDを主キーに設定
    FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID), -- ユーザーIDを参照
    FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID), -- ステージIDを参照
    FOREIGN KEY (ALGORITHM_ID) REFERENCES ALGORITHM (ALGORITHM_ID) -- アルゴリズムIDを参照
);


CREATE TABLE STAGE_TILE (
    STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID
    TILE_DATA CLOB NOT NULL, -- タイル配置データ
    PRIMARY KEY (STAGE_ID), -- ステージIDを主キーに設定
    FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID) -- ステージIDを参照
);

----------------------------------------------------------------------------------------------------------
DROP TABLE algorithm CASCADE CONSTRAINTS;
DROP TABLE clear_stage CASCADE CONSTRAINTS;
DROP TABLE node CASCADE CONSTRAINTS;
DROP TABLE node_type CASCADE CONSTRAINTS;
DROP TABLE score CASCADE CONSTRAINTS;
DROP TABLE score_history CASCADE CONSTRAINTS;
DROP TABLE stage CASCADE CONSTRAINTS;
DROP TABLE stage_tile CASCADE CONSTRAINTS;
DROP TABLE users CASCADE CONSTRAINTS;
DROP TABLE STAGE_CLEAR_HISTORY CASCADE CONSTRAINTS;


-- -- ユーザー情報を保持するテーブル
-- CREATE TABLE USERS (
--     USER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ユーザーID
--     NAME VARCHAR2(64) NOT NULL UNIQUE, -- ユーザー名（ユニーク制約付き）
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     HASHED_PASSWORD VARCHAR2(128) NOT NULL, -- ハッシュ化されたパスワード
--     PRIMARY KEY (USER_ID) -- ユーザーIDを主キーに設定
-- );

-- -- キャラクター情報を保持するテーブル
-- CREATE TABLE CHARACTER (
--     CHARACTER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- キャラクターID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     CHARACTER_NAME VARCHAR2(64) NOT NULL, -- キャラクター名
--     CHARACTER_TYPE VARCHAR2(64) NOT NULL, -- キャラクタータイプ
--     CHARACTER_IMG VARCHAR2(64) NOT NULL, -- キャラクターの画像パス
--     PRIMARY KEY (CHARACTER_ID) -- キャラクターIDを主キーに設定
-- );

-- -- アイテム情報を保持するテーブル
-- CREATE TABLE GAME_ITEM (
--     ITEM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- アイテムID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     ITEM_NAME VARCHAR2(64) NOT NULL, -- アイテム名
--     ITEM_TYPE VARCHAR2(64) NOT NULL, -- アイテムタイプ
--     GAME_IMG VARCHAR2(64) NOT NULL, -- アイテムの画像パス
--     PRIMARY KEY (ITEM_ID) -- アイテムIDを主キーに設定
-- );

-- -- スコア情報を保持するテーブル
-- CREATE TABLE SCORE (
--     SCORE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- スコアID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     SCORE NUMBER(10, 3) NOT NULL, -- スコア
--     PRIMARY KEY (SCORE_ID) -- スコアIDを主キーに設定
-- );

-- -- ノードの種類情報を保持するテーブル
-- CREATE TABLE NODE_TYPE (
--     NODE_TYPE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ノードの種類ID
--     NODE_NAME VARCHAR2(64) NOT NULL, -- ノード名
--     PRIMARY KEY (NODE_TYPE_ID) -- ノード種類IDを主キーに設定
-- );

-- -- ステージ情報を保持するテーブル
-- CREATE TABLE STAGE (
--     STAGE_ID VARCHAR2(5) NOT NULL, -- 0から始まる5桁のステージID（手動入力）
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     FLOOR_NUMBER NUMBER NOT NULL, -- フロア番号
--     BUILDING_NUMBER NUMBER NOT NULL, -- 号館番号 (新規追加)
--     DESCRIPTION VARCHAR2(256) NOT NULL, -- ステージの説明（サイズを256に拡大）
--     ITEM_ID NUMBER NOT NULL, -- ステージに配置されたアイテムID
--     CHARACTER_ID NUMBER NOT NULL, -- ステージに配置されたキャラクターID
--     STAGE_NAME VARCHAR2(64) NOT NULL, -- ステージ名
--     PRIMARY KEY (STAGE_ID), -- ステージIDを主キーに設定
--     FOREIGN KEY (ITEM_ID) REFERENCES GAME_ITEM (ITEM_ID), -- アイテムIDを参照
--     FOREIGN KEY (CHARACTER_ID) REFERENCES CHARACTER (CHARACTER_ID) -- キャラクターIDを参照
-- );


-- -- アルゴリズム情報を保持するテーブル
-- CREATE TABLE ALGORITHM (
--     ALGORITHM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- アルゴリズムID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     USER_ID NUMBER NOT NULL, -- ユーザーID
--     STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID（VARCHAR2に変更）
--     PRIMARY KEY (ALGORITHM_ID), -- アルゴリズムIDを主キーに設定
--     FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID), -- ユーザーIDを参照
--     FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID) -- ステージIDを参照
-- );


-- -- ノード情報を保持するテーブル
-- CREATE TABLE NODE (
--     NODE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- ノードID
--     SEQUENCE_NUMBER NUMBER NOT NULL, -- ノードの順番
--     NODE_TYPE_ID NUMBER NOT NULL, -- ノードの種類ID
--     ALGORITHM_ID NUMBER NOT NULL, -- アルゴリズムID
--     PRIMARY KEY (NODE_ID), -- ノードIDを主キーに設定
--     FOREIGN KEY (NODE_TYPE_ID) REFERENCES NODE_TYPE (NODE_TYPE_ID), -- ノード種類を参照
--     FOREIGN KEY (ALGORITHM_ID) REFERENCES ALGORITHM (ALGORITHM_ID) -- アルゴリズムIDを参照
-- );

-- -- スコア履歴を保持するテーブル
-- CREATE TABLE SCORE_HISTORY (
--     SCORE_HISTORY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- スコア履歴ID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     USER_ID NUMBER NOT NULL, -- ユーザーID
--     STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID（VARCHAR2に変更）
--     SCORE_ID NUMBER NOT NULL, -- スコアID
--     ALGORITHM_ID_0 NUMBER NOT NULL, -- 使用されたアルゴリズムID
--     PRIMARY KEY (SCORE_HISTORY_ID), -- スコア履歴IDを主キーに設定
--     FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID), -- ユーザーIDを参照
--     FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID), -- ステージIDを参照
--     FOREIGN KEY (SCORE_ID) REFERENCES SCORE (SCORE_ID), -- スコアIDを参照
--     FOREIGN KEY (ALGORITHM_ID_0) REFERENCES ALGORITHM (ALGORITHM_ID) -- アルゴリズムIDを参照
-- );


-- -- クリアしたステージ情報を保持するテーブル
-- CREATE TABLE CLEAR_STAGE (
--     CLEAR_STAGE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, -- クリア履歴ID
--     CREATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 作成日時
--     UPDATED_AT DATE DEFAULT CURRENT_TIMESTAMP NOT NULL, -- 更新日時
--     USER_ID NUMBER NOT NULL, -- ユーザーID
--     STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID (VARCHAR2に変更)
--     PRIMARY KEY (CLEAR_STAGE_ID), -- クリア履歴IDを主キーに設定
--     FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID), -- ユーザーIDを参照
--     FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID) -- ステージIDを参照
-- );


-- -- ステージタイルの情報を保持するテーブル
-- CREATE TABLE STAGE_TILE (
--     STAGE_ID VARCHAR2(5) NOT NULL, -- ステージID (VARCHAR2に変更)
--     TILE_DATA CLOB NOT NULL, -- タイル配置データ
--     PRIMARY KEY (STAGE_ID), -- ステージIDを主キーに設定
--     FOREIGN KEY (STAGE_ID) REFERENCES STAGE (STAGE_ID) -- ステージIDを参照
-- );